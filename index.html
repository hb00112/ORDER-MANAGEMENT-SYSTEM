<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order Management System</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
        }
        h1, h2 {
            color: #333;
        }
        form {
            margin-bottom: 20px;
        }
        label, select, input {
            margin: 5px 0;
            display: block;
        }
        button {
            margin-top: 10px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
    </style>
</head>
<body>
    <h1>Order Management System</h1>

    <h2>Add Order</h2>
    <form id="addOrderForm">
        <label for="party">Party:</label>
        <select id="party" required>
            <option value="PARTY A">PARTY A</option>
            <option value="PARTY B">PARTY B</option>
            <option value="PARTY C">PARTY C</option>
        </select>

        <label for="itemType">Item Type:</label>
        <select id="itemType" required>
            <option value="O.E">O.E</option>
            <option value="CLAZ">CLAZ</option>
        </select>

        <label for="size">Size:</label>
        <select id="size" required>
            <option value="S">S</option>
            <option value="M">M</option>
            <option value="L">L</option>
            <option value="XL">XL</option>
            <option value="2XL">2XL</option>
            <option value="60">60</option>
            <option value="65">65</option>
            <option value="70">70</option>
            <option value="75">75</option>
        </select>

        <label for="quantity">Quantity:</label>
        <input type="number" id="quantity" required min="1">

        <button type="submit">Add Order</button>
    </form>

    <h2>Pending Orders</h2>
    <table id="pendingOrdersTable">
        <thead>
            <tr>
                <th>Party</th>
                <th>Item Type</th>
                <th>Size</th>
                <th>Quantity</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <h2>Sent Orders</h2>
    <table id="sentOrdersTable">
        <thead>
            <tr>
                <th>Party</th>
                <th>Item Type</th>
                <th>Size</th>
                <th>Quantity</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getDatabase, ref, push, onValue, remove, set } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDPA5tLm3H889inLZvh_uWAHOxGNhC0gLc",
            authDomain: "order-management-system-ea2d3.firebaseapp.com",
            databaseURL: "https://order-management-system-ea2d3-default-rtdb.firebaseio.com",
            projectId: "order-management-system-ea2d3",
            storageBucket: "order-management-system-ea2d3.appspot.com",
            messagingSenderId: "779242930925",
            appId: "1:779242930925:web:46d09278bedd87d6aac2e4",
            measurementId: "G-K0F1E6FY6C"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // Add order form submission
        document.getElementById('addOrderForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const order = {
                party: document.getElementById('party').value,
                itemType: document.getElementById('itemType').value,
                size: document.getElementById('size').value,
                quantity: parseInt(document.getElementById('quantity').value)
            };
            push(ref(db, 'pendingOrders'), order);
            this.reset();
        });

        // Listen for changes in pending orders
        onValue(ref(db, 'pendingOrders'), (snapshot) => {
            const pendingOrders = snapshot.val();
            const tableBody = document.querySelector('#pendingOrdersTable tbody');
            tableBody.innerHTML = '';
            for (let id in pendingOrders) {
                const order = pendingOrders[id];
                const row = tableBody.insertRow();
                row.innerHTML = `
                    <td>${order.party}</td>
                    <td>${order.itemType}</td>
                    <td>${order.size}</td>
                    <td>${order.quantity}</td>
                    <td>
                        <input type="number" min="1" max="${order.quantity}" value="${order.quantity}">
                        <button onclick="dispatchOrder('${id}', this.previousElementSibling.value)">Dispatch</button>
                    </td>
                `;
            }
        });

        // Listen for changes in sent orders
        onValue(ref(db, 'sentOrders'), (snapshot) => {
            const sentOrders = snapshot.val();
            const tableBody = document.querySelector('#sentOrdersTable tbody');
            tableBody.innerHTML = '';
            for (let id in sentOrders) {
                const order = sentOrders[id];
                const row = tableBody.insertRow();
                row.innerHTML = `
                    <td>${order.party}</td>
                    <td>${order.itemType}</td>
                    <td>${order.size}</td>
                    <td>${order.quantity}</td>
                `;
            }
        });

        // Dispatch order function
        window.dispatchOrder = function(id, dispatchQuantity) {
            const pendingOrderRef = ref(db, `pendingOrders/${id}`);
            const sentOrdersRef = ref(db, 'sentOrders');

            onValue(pendingOrderRef, (snapshot) => {
                const order = snapshot.val();
                dispatchQuantity = parseInt(dispatchQuantity);

                if (dispatchQuantity > 0 && dispatchQuantity <= order.quantity) {
                    const sentOrder = {...order, quantity: dispatchQuantity};
                    push(sentOrdersRef, sentOrder);

                    if (dispatchQuantity === order.quantity) {
                        remove(pendingOrderRef);
                    } else {
                        set(pendingOrderRef, {...order, quantity: order.quantity - dispatchQuantity});
                    }
                } else {
                    alert('Invalid dispatch quantity');
                }
            }, {
                onlyOnce: true
            });
        };
    </script>
</body>
</html>